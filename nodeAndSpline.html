<!DOCTYPE html>
<html>
 <!--         <script src="script/nodeAndSpline.js">
      </script> -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="stylesheet" type="text/css" href="css/nodeAndSpline.css">
    <link rel="stylesheet" type="text/css" href="css/dragDrop.css">

  <head>
    <title>Spline Editor</title>    



  </head>
  <body>  
      
      <!-- SVG -->
      
      <svg width="960" height="600" id="mySVG" style ="border:1px solid #000000;">

          
          <path id="mySpline" style="stroke:rgb(247, 162, 4);stroke-width:5" fill="transparent"/>
          <line id="myLine" style="stroke:rgb(247, 162, 4);stroke-width:5" fill="transparent"/>
               <!-- <circle class="circleNode" cx="300" cy="300" r="10" style="stroke:rgb(247, 162, 4);stroke-width:5"/> -->
              
              
            
       
        <!--     <g>
                        <rect x="10" y="10" id="myNode" fill="transparent">
                        <image id="node" src="images/node_yellow.png" draggable="false";></image>
                            </rect>
                        </g> 
          
         -->
            <g style="">
                <g id="g-container" transform="translate(60,41)" style="overflow: hidden;">
                <foreignObject id="foreignContainer"style="overflow:hidden;" pointer-events="all" width="200" height="660">

                <div id="myDiv" draggable="true">
                  <!-- Include a header DIV with the same name as the draggable DIV, followed by "header" -->
                  <div id="myDivHeader">Click here to move</div>
                  <div class="text" draggable="true" contentEditable="true">
                        + name: String <br>
                        + address: Address <br>
                        + ID: String <br>
                        + salary: int <br>
                        + jobType: String <br>
                    </div>
                    
                        <img onclick="connectNodes(this.id)" id="node" class="node" src="images/node_yellow_whole.png" draggable="false";/>
                    
                  
                 <!--   <svg width="32" height="32" fill="transparent">
                        <rect fill="transparent">
                        <image onClick="getClickCoordinate(this.id)" id="myNode" src="images/node_yellow.png" draggable="false";/>
                            </rect> 
                        </svg> -->
                    
                    <div id="Content1"></div>
                     <strong><div class="text" draggable="true" contentEditable="true"></div></strong>
                    <div id="Content2" draggable="true" contentEditable="true" ></div> 
                    <div class="status"  tabindex="1" id="inProgress">In-Progress</div>
                    <div class="status"  tabindex="1" id="done">Done</div>
                    <div id="expand" style="border: 1px solid black">Utvid</div>

                    <div id="box1">
                        <div id="members" >Assigned: </div><button id="btnAddMembers">Klikk her</button>
                        <div id="newMember" contentEditable="true">Member 1</div>
                    </div>



                </div>
                    
                    <div id="DELETE1" >DELETE1</div>
                </foreignObject>
            </g>
        </g>
          
      </svg>

      <!-- SCRIPT -->
       <script>       
            //set up the SVG
            var svg = document.getElementById("mySVG");
            var evt = window.Event;
            
           
           //sets mouse and node position as a global variable
           var mousePos = getMousePos(svg, evt);
            var mouseX = mousePos.x;
            var mouseY = mousePos.y;
            //use this when 
            var mouseCoordinate = mouseX + ", " + mouseY;
            // var mouseClick = document.getElementById("newNode1"); //defines it so we can assign it as we click
           
            var nodeX1 = document.getElementsByClassName("node");
            var nodeY1 = document.getElementsByClassName("node");
           
            
            
            
            //var nodeBX = document.getElementById("newNode2").getAttribute("x");
            //var nodeBY = document.getElementById("newNode2").getAttribute("y");
            
           
            //report the mouse position while it moves, then sets <path "d" /> to what toString returns.
            svg.addEventListener("mousemove", function (evt) {
                var mousePos = getMousePos(svg, evt);
                var mouseX = mousePos.x;
                var mouseY = mousePos.y;
               
                document.querySelector("#mySVG #mySpline").setAttribute("d",toString(mouseX,mouseY));
                
                
            }, false);
           
           
           
           // when you click the left mouse button, the node will appear.
           
        /*   function addElement(){
               
               
               
               var = newElement = document.getElementById("mySpline").cloneNode(true);
               newElement.setAttribute()
               newElement.id = "newSpline";
               newElement.d = toString(mouseX,mouseY);
               
           } */
           

           
          // var triggerNode = document.getElementById("newNode");
          // triggerNode.addEventListener("click",addElement);
           
           //document.body.addEventListener("click", getClickCoordinate);
           
           var index = 0;
           
           var nodeAClick = undefined;
           var nodeBClick = undefined;
           
           var nodeTrigger = document.getElementsByClassName("node");
           document.body.addEventListener("click",connectNodes);
            
           function connectNodes(evt){
               
               //var nodeA = document.getElementsByClassName("node").getBoundingClientRect();
               
               //asks if the class name we click on is named "node" AND if the index boolean is false
               if(evt.target.className == "node" && index == false){
                    

                    index = !index;
                    //nodeAClick = evt.target.getAttribute("x") + " " + evt.target.getAttribute("y");
                    //console.log(nodeAClick);
                   
                    var rect = document.getElementById("node").getBoundingClientRect();
                    console.log("position is " + rect.top + "," + rect.left);
                   
                    return evt.target.getAttribute("x") + " " + evt.target.getAttribute("y");
                    console.log("Returning coordinates of A");
                    //document.querySelector("#mySVG #myLine").setAttribute("x1",toString(nodeAClick));
                   
                 //return evt.target.getAttribute("x") + evt.target.getAttribute("y");
                //console.log(evt.target.getAttribute("x") + " " + evt.target.getAttribute("y"));
                   
                 
               } else if(evt.target.className == "node" && index){
                   
                   index = !index;
                   // nodeBClick = evt.target.getAttribute("x") + " " + evt.target.getAttribute("y") ;
                   // console.log(nodeBClick);
                   
                   var rect = document.getElementById("node").getBoundingClientRect();
                    console.log("position is " + rect.top + " " + rect.left);
                   
                   
                   return evt.target.getAttribute("x") + " " + evt.target.getAttribute("y");
                   console.log("Returning coordinates of B");
                   
               } 
               
           }
           
           
             
           // gets mouse X and Y coordinates and returns it as a string
              function toString(nodeAClick, nodeBClick, evt){
                
                var nodeX = document.getElementsByClassName("node").getAttribute("x");
                var nodeY = document.getElementsByClassName("node").getAttribute("y");
                // gets Element ID of the element you click on  
                var rectA = document.getElementsByClassName("node").getBoundingClientRect();  
                var rectB = document.getElementsByClassName("node").getBoundingClientRect();
                
                  var nodeAX = rectA.x;
                  var nodeAY = rectA.y;
                  //var nodeBX = rectB.x;
                  //var nodeBY = rectB.y;
                  
                  // cleaner formatting
                  var nodeA = rectA.x + " " + rectA.y;
                  var nodeB = rectB.x + " " + rectB.y;
                  
                  // anchor points are control points on a bezier curve that bends the curve
                  //var nodeAnchor = nodeX + 50;
                  //var anchorPoint = mouseX - 5;
                  
                  //returns the coordinates as a string
                  return "M" + nodeA +  ", " + nodeB;
                  //return "M" + nodeX + " " + nodeY +  ", " + mouseX + " " + mouseY;
                  
              }
           /*
            function findAbsolutePosition(htmlElement) {
              var x = htmlElement.offsetLeft;
              var y = htmlElement.offsetTop;
              for (var x=0, y=0, el=htmlElement; 
                   el != null; 
                   el = el.offsetParent) {
                     x += el.offsetLeft;
                     y += el.offsetTop;
              }
              return {
                  "x": x,
                  "y": y
              };
            } */
           
            //Get Mouse Position
            function getMousePos(svg, evt) {
                var rect = svg.getBoundingClientRect();
                return {
                    x: evt.clientX - rect.left,
                    y: evt.clientY - rect.top
                    
                };
            }  
          
        </script>
      
      <script type="text/javascript" src="script/dragDrop.js">
    </script>
      <script src="script/jsplumb.min.js "></script>
    </body>
</html>